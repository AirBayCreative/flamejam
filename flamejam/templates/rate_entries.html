{% extends "base.html" %}
{% from "_formhelpers.html" import form_errors %}

{% block title %}Rating on {{ entry.jam.title }}{% endblock %}

{% block content %}
<h1>{{ entry.jam.title }} &raquo; Rating</h1>

<h2>Please rate: {{ entry.title }} by {{ entry.participant.getLink() }}</h2>

<form action="{{ url_for('rate_entries', jam_slug=jam.slug, action='submit_rating')}}" method="post">
{{ rate_form.hidden_tag() }}
<div class="box">
    <div class="box-content">
        <p>
            Here you can give up- and downvotes! <b>One point</b> is the worst and <b>ten points</b> the best you can give.
        </p>
        <p>
            <table class="details">
                {% macro renderScoreField(field) %}
                <tr><th>{{ field.label }}</th><td>{{ field(class="text-input slider", size=1, style="text-align: center;") }}
                    </td></tr>
                {% endmacro %}
                {{ renderScoreField(rate_form.score_gameplay) }}
                {{ renderScoreField(rate_form.score_graphics) }}
                {{ renderScoreField(rate_form.score_audio) }}
                {{ renderScoreField(rate_form.score_innovation) }}
                {{ renderScoreField(rate_form.score_story) }}
                {{ renderScoreField(rate_form.score_technical) }}
                {{ renderScoreField(rate_form.score_controls) }}
                {{ renderScoreField(rate_form.score_overall) }}

                <tr><th>{{ rate_form.note.label }}</th><td>
                    {{ rate_form.note(class="text-input", size = 100) }}
                    <div class="input-info">Optional, <b>not</b> parsed with markdown</div>
                    </td></tr>
            </table>
        </p>
    </div>

    <p class="form-buttons">
        <input type="submit" value="submit &raquo;" class="button default" />
    </p>
</div>
</form>

<div class="box">
    <div class="box-content">
        {% if not is_skipped_entry %}
        <form style="float: right;" action="{{ url_for('rate_entries',
            jam_slug=jam.slug,
            action='skip_rating')}}" method="post">
            {{ skip_form.hidden_tag() }}
            {{ skip_form.reason.label }}
            {{ skip_form.reason() }}
            <input type="submit" value="skip &raquo;" class="button" />
        </form>
        {% else %}
        <p>You cannot skip this entry. You already skipped it, and no unskipped entries are left for you to rate.</p>
        {% endif %}

        <ul style="margin-top: 5px;" class="tabs">
            <li><a href="{{ entry.jam.url() }}">&laquo; Back to the jam</a></li>
            <li>
                Rating progress:
                {{ participant.getRatingCount(jam) }} /
                {{ entry.jam.entries.all() | length }} rated,
                {{ participant.getSkippedCount(jam) }} skipped
            </li>
        </ul>

        <div style="clear: right;"></div>
    </div>
</div>

<h2>Overview: Entries of this jam</h2>
<ul>
{% for e in jam.entries %}
    <li><a href="{{ e.url() }}">{{ e.title }}</a> {% if participant in e.rated_by
    %}rated{% endif %}{% if participant in e.skipped_by
    %}skipped{% endif %}</li>
{% endfor %}
</ul>
<p>Click to unskip</p>

{% endblock %}
